# Implementation Checklist: Document Handling User Stories

This document provides a detailed implementation plan for User Stories 2.1 through 2.9 from the Document Handling feature set, following Test Driven Development methodology while utilizing the existing database schema and codebase.

## US2.1: Navigate Project Contents

### Backend Implementation

#### 1. Domain Model
- [x] Create `Document` entity
  - [x] Include fields: id, name, path, projectId, folderId, fileType, size, createdAt, updatedAt, createdBy
  - [x] Add version tracking fields if needed

- [x] Create `Folder` entity
  - [x] Include fields: id, name, path, projectId, parentFolderId, createdAt, updatedAt, createdBy

#### 2. Repository Layer
- [x] Create `DocumentRepository` interface
  - [x] Write test for finding documents by projectId
  - [x] Write test for finding documents by folderId
  - [x] Write test for saving a document
  - [x] Implement the repository interface

- [x] Create `FolderRepository` interface
  - [x] Write test for finding folders by projectId
  - [x] Write test for finding folders by parentFolderId
  - [x] Write test for saving a folder
  - [x] Implement the repository interface

#### 3. Service Layer
- [x] Create `DocumentService` interface
  - [x] Define method for retrieving project documents
  - [x] Define method for retrieving folder documents
  - [x] Define method for retrieving document by id

- [x] Create `DocumentServiceImpl` class
  - [x] Write test for retrieving project documents
  - [x] Write test for retrieving folder documents
  - [x] Write test for retrieving document by id
  - [x] Implement service methods
  - [x] Add authorization checks for project access

- [x] Create `FolderService` interface
  - [x] Define method for retrieving project folders
  - [x] Define method for retrieving subfolders
  - [x] Define method for retrieving folder by id

- [x] Create `FolderServiceImpl` class
  - [x] Write test for retrieving project folders
  - [x] Write test for retrieving subfolders
  - [x] Write test for retrieving folder by id
  - [x] Implement service methods
  - [x] Add authorization checks for project access

#### 4. DTO Objects
- [x] Create `DocumentDTO` class
  - [x] Include fields: id, name, path, projectId, folderId, fileType, size, createdAt, createdBy
  - [x] Write test for DTO conversion

- [x] Create `FolderDTO` class
  - [x] Include fields: id, name, path, projectId, parentFolderId, createdAt, createdBy
  - [x] Write test for DTO conversion

- [x] Create `DocumentMapper` interface/class
  - [x] Write test for mapping between entity and DTOs
  - [x] Implement mapper methods

- [x] Create `FolderMapper` interface/class
  - [x] Write test for mapping between entity and DTOs
  - [x] Implement mapper methods

#### 5. Controller Layer
- [x] Create `DocumentController` class
  - [x] Write test for GET /api/projects/{id}/documents endpoint
  - [x] Write test for GET /api/folders/{id}/documents endpoint
  - [x] Write test for GET /api/documents/{id} endpoint
  - [x] Implement controller methods
  - [x] Add proper authorization checks

- [x] Create `FolderController` class
  - [x] Write test for GET /api/projects/{id}/folders endpoint
  - [x] Write test for GET /api/folders/{id}/subfolders endpoint
  - [x] Write test for GET /api/folders/{id} endpoint
  - [x] Implement controller methods
  - [x] Add proper authorization checks

#### 6. Integration Tests
- [x] Write integration test for the complete flow
  - [x] Test retrieving project documents and folders
  - [x] Test retrieving subfolder documents
  - [x] Test proper authorization

### Frontend Implementation

#### 1. API Client
- [x] Create `documentApi.ts` file
  - [x] Write test for fetching project documents
  - [x] Write test for fetching folder documents
  - [x] Write test for fetching document details
  - [x] Implement API client methods

- [x] Create `folderApi.ts` file
  - [x] Write test for fetching project folders
  - [x] Write test for fetching subfolders
  - [x] Write test for fetching folder details
  - [x] Implement API client methods

#### 2. Redux State Management
- [x] Create `documentSlice.ts` file
  - [x] Define state interface with documents array, loading state, error state
  - [x] Write tests for async thunks
  - [x] Write tests for reducers
  - [x] Implement slice with reducers and selectors

- [x] Create `folderSlice.ts` file
  - [x] Define state interface with folders array, loading state, error state
  - [x] Write tests for async thunks
  - [x] Write tests for reducers
  - [x] Implement slice with reducers and selectors

#### 3. Components
- [x] Create `FolderTree` component
  - [x] Write test for rendering folder hierarchy
  - [x] Write test for folder expansion/collapse
  - [x] Write test for folder selection
  - [x] Implement component

- [x] Create `DocumentList` component
  - [x] Write test for rendering document list
  - [x] Write test for empty state
  - [x] Write test for document selection
  - [x] Implement component

- [x] Create `Breadcrumbs` component
  - [x] Write test for rendering breadcrumb path
  - [x] Write test for breadcrumb navigation
  - [x] Implement component

#### 4. Page Component
- [x] Create `ProjectDocumentsPage` component
  - [x] Write test for loading folders and documents on mount
  - [x] Write test for folder navigation
  - [x] Write test for breadcrumb navigation
  - [x] Write test for authorization checks
  - [x] Implement page component

#### 5. Routing
- [x] Update router configuration
  - [x] Add route for project documents page
  - [x] Add route for folder view
  - [x] Add route guard for project access

## US2.2: Upload Documents

### Backend Implementation

#### 1. Service Layer
- [x] Update `DocumentService` interface
  - [x] Define method for uploading documents
  - [x] Define method for validating document data

- [x] Update `DocumentServiceImpl` class
  - [x] Write test for document upload
  - [x] Write test for validation logic
  - [x] Implement service methods
  - [x] Add authorization checks for Project Manager role

#### 2. Storage Service
- [x] Create `StorageService` interface
  - [x] Define method for storing files
  - [x] Define method for retrieving files

- [x] Create `FileSystemStorageService` class
  - [x] Write test for storing files
  - [x] Write test for retrieving files
  - [x] Implement service methods

#### 3. DTO Objects
- [x] Create `DocumentUploadDTO` class
  - [x] Include fields: name, projectId, folderId, file
  - [x] Write test for DTO validation

#### 4. Controller Layer
- [x] Update `DocumentController` class
  - [x] Write test for POST /api/documents endpoint
  - [x] Write test for multipart file upload
  - [x] Write test for validation errors
  - [x] Implement controller method
  - [x] Add proper authorization checks (Project Manager role)

#### 5. Integration Tests
- [x] Write integration test for the complete flow
  - [x] Test uploading documents with valid data
  - [x] Test validation errors
  - [x] Test proper authorization

### Frontend Implementation

#### 1. API Client
- [x] Update `documentApi.ts` file
  - [x] Write test for uploading documents
  - [x] Implement API client method

#### 2. Redux State Management
- [x] Update `documentSlice.ts` file
  - [x] Write test for uploadDocument async thunk
  - [x] Implement action creators, reducers, and selectors

#### 3. Components
- [x] Create `DocumentUpload` component
  - [x] Write test for file selection
  - [x] Write test for upload progress
  - [x] Write test for upload completion
  - [x] Write test for error handling
  - [x] Implement component

#### 4. Integration
- [x] Update `ProjectDocumentsPage` component
  - [x] Add upload functionality for Project Managers
  - [x] Write test for upload flow
  - [x] Write test for authorization checks
  - [x] Implement functionality

## US2.3: Create Folders

### Backend Implementation

#### 1. Service Layer
- [x] Update `FolderService` interface
  - [x] Define method for creating folders
  - [x] Define method for validating folder data

- [x] Update `FolderServiceImpl` class
  - [x] Write test for folder creation
  - [x] Write test for validation logic
  - [x] Implement service methods
  - [x] Add authorization checks for Project Manager role

#### 2. DTO Objects
- [x] Create `FolderCreateDTO` class
  - [x] Include fields: name, projectId, parentFolderId
  - [x] Write test for DTO validation

#### 3. Controller Layer
- [x] Update `FolderController` class
  - [x] Write test for POST /api/folders endpoint
  - [x] Write test for validation errors
  - [x] Implement controller method
  - [x] Add proper authorization checks (Project Manager role)

#### 4. Integration Tests
- [x] Write integration test for the complete flow
  - [x] Test creating folders with valid data
  - [x] Test validation errors
  - [x] Test proper authorization

### Frontend Implementation

#### 1. API Client
- [x] Update `folderApi.ts` file
  - [x] Write test for creating folders
  - [x] Implement API client method

#### 2. Redux State Management
- [x] Update `folderSlice.ts` file
  - [x] Write test for createFolder async thunk
  - [x] Implement action creators, reducers, and selectors

#### 3. Components
- [x] Create `CreateFolderDialog` component
  - [x] Write test for dialog rendering
  - [x] Write test for form validation
  - [x] Write test for form submission
  - [x] Implement component

#### 4. Integration
- [x] Update `ProjectDocumentsPage` component
  - [x] Add create folder functionality for Project Managers
  - [x] Write test for create folder flow
  - [x] Write test for authorization checks
  - [x] Implement functionality

## US2.4: View Documents in-app

### Backend Implementation

#### 1. Service Layer
- [ ] Update `DocumentService` interface
  - [ ] Define method for retrieving document content
  - [ ] Define method for determining document viewability

- [ ] Update `DocumentServiceImpl` class
  - [ ] Write test for retrieving document content
  - [ ] Write test for determining document viewability
  - [ ] Implement service methods
  - [ ] Add authorization checks for document access

#### 2. Controller Layer
- [ ] Update `DocumentController` class
  - [ ] Write test for GET /api/documents/{id}/content endpoint
  - [ ] Write test for proper content type headers
  - [ ] Implement controller method
  - [ ] Add proper authorization checks

#### 3. Integration Tests
- [ ] Write integration test for the complete flow
  - [ ] Test retrieving document content
  - [ ] Test proper authorization
  - [ ] Test content type handling

### Frontend Implementation

#### 1. API Client
- [ ] Update `documentApi.ts` file
  - [ ] Write test for fetching document content
  - [ ] Implement API client method

#### 2. Components
- [ ] Create `DocumentViewer` component
  - [ ] Write test for rendering different document types (PDF, TXT, images)
  - [ ] Write test for unsupported file types
  - [ ] Write test for loading state
  - [ ] Implement component

- [ ] Create `PDFViewer` component
  - [ ] Write test for rendering PDF documents
  - [ ] Write test for page navigation
  - [ ] Implement component

- [ ] Create `TextViewer` component
  - [ ] Write test for rendering text documents
  - [ ] Implement component

- [ ] Create `ImageViewer` component
  - [ ] Write test for rendering image documents
  - [ ] Implement component

#### 3. Page Component
- [ ] Create `DocumentViewPage` component
  - [ ] Write test for loading document content
  - [ ] Write test for rendering appropriate viewer
  - [ ] Write test for authorization checks
  - [ ] Implement page component

#### 4. Routing
- [ ] Update router configuration
  - [ ] Add route for document view page
  - [ ] Add route guard for document access

## US2.5: Download Documents

### Backend Implementation

#### 1. Controller Layer
- [ ] Update `DocumentController` class
  - [ ] Write test for GET /api/documents/{id}/download endpoint
  - [ ] Write test for proper download headers
  - [ ] Implement controller method
  - [ ] Add proper authorization checks

#### 2. Integration Tests
- [ ] Write integration test for the complete flow
  - [ ] Test downloading documents
  - [ ] Test proper authorization

### Frontend Implementation

#### 1. API Client
- [ ] Update `documentApi.ts` file
  - [ ] Write test for downloading documents
  - [ ] Implement API client method

#### 2. Components
- [ ] Create `DownloadButton` component
  - [ ] Write test for initiating download
  - [ ] Write test for download progress
  - [ ] Implement component

#### 3. Integration
- [ ] Update `DocumentList` component
  - [ ] Add download button for each document
  - [ ] Write test for download flow
  - [ ] Implement functionality

- [ ] Update `DocumentViewPage` component
  - [ ] Add download button for current document
  - [ ] Write test for download flow
  - [ ] Implement functionality

## US2.6: Basic Document Search

### Backend Implementation

#### 1. Repository Layer
- [ ] Update `DocumentRepository` interface
  - [ ] Write test for searching documents by name
  - [ ] Implement search method

#### 2. Service Layer
- [ ] Update `DocumentService` interface
  - [ ] Define method for searching documents

- [ ] Update `DocumentServiceImpl` class
  - [ ] Write test for document search
  - [ ] Implement service method
  - [ ] Add authorization checks for project access

#### 3. Controller Layer
- [ ] Update `DocumentController` class
  - [ ] Write test for GET /api/projects/{id}/documents/search endpoint
  - [ ] Implement controller method
  - [ ] Add proper authorization checks

#### 4. Integration Tests
- [ ] Write integration test for the complete flow
  - [ ] Test searching documents
  - [ ] Test proper authorization

### Frontend Implementation

#### 1. API Client
- [ ] Update `documentApi.ts` file
  - [ ] Write test for searching documents
  - [ ] Implement API client method

#### 2. Redux State Management
- [ ] Update `documentSlice.ts` file
  - [ ] Write test for searchDocuments async thunk
  - [ ] Implement action creators, reducers, and selectors

#### 3. Components
- [ ] Create `DocumentSearch` component
  - [ ] Write test for search input
  - [ ] Write test for search results
  - [ ] Write test for empty results
  - [ ] Implement component

#### 4. Integration
- [ ] Update `ProjectDocumentsPage` component
  - [ ] Add search functionality
  - [ ] Write test for search flow
  - [ ] Implement functionality

## US2.7: Delete Documents and Folders

### Backend Implementation

#### 1. Service Layer
- [x] Update `DocumentService` interface
  - [x] Define method for deleting documents

- [x] Update `DocumentServiceImpl` class
  - [x] Write test for document deletion
  - [x] Implement service method
  - [x] Add authorization checks for Project Manager role

- [x] Update `FolderService` interface
  - [x] Define method for deleting folders
  - [x] Define method for checking if folder is empty

- [x] Update `FolderServiceImpl` class
  - [x] Write test for folder deletion
  - [x] Write test for empty folder check
  - [x] Implement service methods
  - [x] Add authorization checks for Project Manager role

#### 2. Controller Layer
- [x] Update `DocumentController` class
  - [x] Write test for DELETE /api/documents/{id} endpoint
  - [x] Implement controller method
  - [x] Add proper authorization checks

- [x] Update `FolderController` class
  - [x] Write test for DELETE /api/folders/{id} endpoint
  - [x] Write test for non-empty folder error
  - [x] Implement controller method
  - [x] Add proper authorization checks

#### 3. Integration Tests
- [x] Write integration test for the complete flow
  - [x] Test deleting documents
  - [x] Test deleting empty folders
  - [x] Test attempting to delete non-empty folders
  - [x] Test proper authorization

### Frontend Implementation

#### 1. API Client
- [x] Update `documentApi.ts` file
  - [x] Write test for deleting documents
  - [x] Implement API client method

- [x] Update `folderApi.ts` file
  - [x] Write test for deleting folders
  - [x] Implement API client method

#### 2. Redux State Management
- [x] Update `documentSlice.ts` file
  - [x] Write test for deleteDocument async thunk
  - [x] Implement action creators, reducers, and selectors

- [x] Update `folderSlice.ts` file
  - [x] Write test for deleteFolder async thunk
  - [x] Implement action creators, reducers, and selectors

#### 3. Components
- [x] Create `DeleteDocumentConfirmation` component
  - [x] Write test for confirmation dialog
  - [x] Write test for confirm/cancel actions
  - [x] Implement component

- [x] Create `DeleteFolderConfirmation` component
  - [x] Write test for confirmation dialog
  - [x] Write test for confirm/cancel actions
  - [x] Write test for non-empty folder error
  - [x] Implement component

#### 4. Integration
- [x] Update `DocumentList` component
  - [x] Add delete option for Project Managers
  - [x] Write test for delete flow
  - [x] Write test for authorization checks
  - [x] Implement functionality

- [x] Update `FolderTree` component
  - [x] Add delete option for Project Managers
  - [x] Write test for delete flow
  - [x] Write test for authorization checks
  - [x] Implement functionality

## US2.8: Document Versioning

### Backend Implementation

#### 1. Domain Model
- [ ] Update `Document` entity
  - [ ] Add version tracking fields: versionNumber, previousVersionId
  - [ ] Update any necessary relationships

#### 2. Repository Layer
- [ ] Update `DocumentRepository` interface
  - [ ] Write test for finding document versions
  - [ ] Implement version query methods

#### 3. Service Layer
- [ ] Update `DocumentService` interface
  - [ ] Define method for handling document versions
  - [ ] Define method for retrieving document versions

- [ ] Update `DocumentServiceImpl` class
  - [ ] Write test for document version handling
  - [ ] Write test for retrieving document versions
  - [ ] Implement service methods
  - [ ] Add authorization checks for Project Manager role

#### 4. DTO Objects
- [ ] Create `DocumentVersionDTO` class
  - [ ] Include fields: id, name, versionNumber, createdAt, createdBy
  - [ ] Write test for DTO conversion

- [ ] Update `DocumentMapper` interface/class
  - [ ] Write test for mapping version information
  - [ ] Implement mapper methods

#### 5. Controller Layer
- [ ] Update `DocumentController` class
  - [ ] Write test for GET /api/documents/{id}/versions endpoint
  - [ ] Write test for POST /api/documents/{id}/versions endpoint
  - [ ] Implement controller methods
  - [ ] Add proper authorization checks

#### 6. Integration Tests
- [ ] Write integration test for the complete flow
  - [ ] Test uploading new versions
  - [ ] Test retrieving document versions
  - [ ] Test proper authorization

### Frontend Implementation

#### 1. API Client
- [ ] Update `documentApi.ts` file
  - [ ] Write test for uploading document versions
  - [ ] Write test for fetching document versions
  - [ ] Implement API client methods

#### 2. Redux State Management
- [ ] Update `documentSlice.ts` file
  - [ ] Write test for uploadDocumentVersion async thunk
  - [ ] Write test for fetchDocumentVersions async thunk
  - [ ] Implement action creators, reducers, and selectors

#### 3. Components
- [ ] Create `DocumentVersionDialog` component
  - [ ] Write test for version prompt (Replace/Keep Both)
  - [ ] Write test for version selection
  - [ ] Implement component

- [ ] Create `DocumentVersionList` component
  - [ ] Write test for rendering version history
  - [ ] Write test for version selection
  - [ ] Implement component

#### 4. Integration
- [ ] Update `DocumentUpload` component
  - [ ] Add version handling for duplicate filenames
  - [ ] Write test for version dialog flow
  - [ ] Implement functionality

- [ ] Update `DocumentViewPage` component
  - [ ] Add version history access
  - [ ] Write test for version history flow
  - [ ] Implement functionality

## US2.9: Define Document Order

### Backend Implementation

#### 1. Domain Model
- [ ] Update `Document` entity
  - [ ] Add displayOrder field
  - [ ] Update any necessary relationships

#### 2. Service Layer
- [ ] Update `DocumentService` interface
  - [ ] Define method for updating document order

- [ ] Update `DocumentServiceImpl` class
  - [ ] Write test for updating document order
  - [ ] Implement service method
  - [ ] Add authorization checks for Project Manager role

#### 3. DTO Objects
- [ ] Create `DocumentOrderUpdateDTO` class
  - [ ] Include fields: documentIds (in desired order)
  - [ ] Write test for DTO validation

#### 4. Controller Layer
- [ ] Update `DocumentController` class
  - [ ] Write test for PUT /api/folders/{id}/documents/order endpoint
  - [ ] Implement controller method
  - [ ] Add proper authorization checks

#### 5. Integration Tests
- [ ] Write integration test for the complete flow
  - [ ] Test updating document order
  - [ ] Test proper authorization

### Frontend Implementation

#### 1. API Client
- [ ] Update `documentApi.ts` file
  - [ ] Write test for updating document order
  - [ ] Implement API client method

#### 2. Redux State Management
- [ ] Update `documentSlice.ts` file
  - [ ] Write test for updateDocumentOrder async thunk
  - [ ] Implement action creators, reducers, and selectors

#### 3. Components
- [ ] Update `DocumentList` component
  - [ ] Add drag-and-drop reordering capability
  - [ ] Write test for drag-and-drop interaction
  - [ ] Write test for order save
  - [ ] Implement functionality

#### 4. Integration
- [ ] Update `ProjectDocumentsPage` component
  - [ ] Add ordering mode toggle for Project Managers
  - [ ] Write test for ordering mode
  - [ ] Write test for authorization checks
  - [ ] Implement functionality

## Testing Strategy

### Unit Tests
- [ ] Backend: Repository tests
  - Test data operations with various parameters

- [ ] Backend: Service tests
  - Test business logic with mocked repositories
  - Test authorization checks
  - Test validation logic

- [ ] Backend: Controller tests
  - Test endpoints with mocked services
  - Test authorization requirements
  - Test response formats
  - Test validation error handling

- [ ] Frontend: Component tests
  - Test rendering with various props
  - Test user interactions
  - Test form validation
  - Test loading/error states

- [ ] Frontend: Redux tests
  - Test action creators
  - Test reducers
  - Test selectors
  - Test async thunks

### Integration Tests
- [ ] Backend API tests
  - Test complete flow from controller to database
  - Test with authentication
  - Test authorization rules

- [ ] Frontend integration tests
  - Test component interaction
  - Test data flow through Redux
  - Test navigation flows

## Implementation Steps (TDD Approach)

1. [ ] Start with writing tests for backend repository methods
2. [ ] Implement repository methods to pass tests
3. [ ] Write tests for service layer methods
4. [ ] Implement service layer to pass tests
5. [ ] Write tests for controller endpoints
6. [ ] Implement controllers to pass tests
7. [ ] Write tests for frontend API client
8. [ ] Implement API client to pass tests
9. [ ] Write tests for Redux slices
10. [ ] Implement Redux slices to pass tests
11. [ ] Write tests for UI components
12. [ ] Implement UI components to pass tests
13. [ ] Integrate components into pages
14. [ ] Perform end-to-end testing

## Definition of Done

### US2.1: Navigate Project Contents
- [x] Users can view the folder structure of a project
- [x] Users can navigate through folders
- [x] Breadcrumbs show the current path
- [x] Users can navigate back to parent folders
- [x] Proper authorization checks are enforced

### US2.2: Upload Documents
- [x] Project Managers can upload documents to folders
- [x] Upload progress is displayed
- [x] Various file formats are supported
- [x] Error handling provides clear feedback
- [x] Proper authorization checks are enforced

### US2.3: Create Folders
- [x] Project Managers can create new folders
- [x] Folder names are validated
- [x] New folders appear immediately in the UI
- [x] Proper authorization checks are enforced

### US2.4: View Documents in-app
- [ ] Users can view supported documents in the browser
- [ ] PDF, TXT, and images are rendered correctly
- [ ] Unsupported file types prompt for download
- [ ] Proper authorization checks are enforced

### US2.5: Download Documents
- [ ] Users can download documents
- [ ] Downloads preserve the original file format
- [ ] Proper authorization checks are enforced

### US2.6: Basic Document Search
- [ ] Users can search for documents by name
- [ ] Search results show folder paths
- [ ] Clicking a result navigates to the document
- [ ] Proper authorization checks are enforced

### US2.7: Delete Documents and Folders
- [x] Project Managers can delete documents
- [x] Project Managers can delete empty folders
- [x] Confirmation is required before deletion
- [x] Non-empty folders cannot be deleted
- [x] Proper authorization checks are enforced

### US2.8: Document Versioning
- [ ] Uploading a file with an existing name prompts for version handling
- [ ] Users can choose to replace or keep both files
- [ ] Version history is accessible for documents
- [ ] Previous versions can be viewed and downloaded
- [ ] Proper authorization checks are enforced

### US2.9: Define Document Order
- [ ] Project Managers can enter an ordering mode
- [ ] Documents can be reordered via drag-and-drop
- [ ] Order is preserved for all users
- [ ] Proper authorization checks are enforced 