# Implementation Checklist: Intelligent Search & Chatbot User Stories

This document provides a detailed implementation plan for User Stories 3.1 through 3.5 from the Intelligent Search & Chatbot feature set, following Test Driven Development methodology while utilizing the existing database schema and codebase.

## US3.1: Document Content Indexing

### Backend Implementation

#### 1. Domain Model
- [x] Create `DocumentContent` entity
  - [x] Include fields: id, documentId, content, indexedAt, indexStatus
  - [x] Add relationship to Document entity

#### 2. Repository Layer
- [x] Create `DocumentContentRepository` interface
  - [x] Implement the repository interface

#### 3. Service Layer
- [x] Create `DocumentIndexingService` interface
  - [x] Define method for indexing document content
  - [x] Define method for retrieving indexed content
  - [x] Define method for handling indexing failures

- [ ] Create `DocumentIndexingServiceImpl` class
  - [ ] Implement service methods

#### 4. Document Processing
- [x] Create `DocumentProcessor` interface
  - [x] Define method for processing different document types (PDF, DOCX, TXT)

- [x] Create document processor implementations
  - [x] Implement processor classes

#### 5. Search Index Integration
- [x] Create `SearchIndexService` interface
  - [x] Define method for adding documents to index
  - [x] Define method for searching the index
  - [x] Define method for removing documents from index

- [ ] Create `SearchIndexServiceImpl` class
  - [ ] Implement service methods

#### 6. Event Listeners
- [ ] Create `DocumentUploadedEventListener`
  - [ ] Implement event listener to trigger indexing

#### 7. Integration Tests
- [ ] Write integration test for the complete flow

### Frontend Implementation
- [ ] No frontend changes required for this user story

## US3.2: Access the Chatbot

### Backend Implementation
- [ ] No significant backend changes required for this user story

### Frontend Implementation

#### 1. Components
- [x] Create `ChatbotButton` component
  - [x] Implement component

- [x] Create `ChatbotInterface` component
  - [x] Implement component

#### 2. Layout Integration
- [x] Update `MainLayout` component
  - [x] Add chatbot button to global layout
  - [x] Implement changes

- [x] Update project-related pages
  - [x] Add project context to chatbot when opened from project pages
  - [x] Implement changes

## US3.3: Ask Questions within a Single Project

### Backend Implementation

#### 1. Domain Model
- [x] Create `ChatMessage` entity
  - [x] Include fields: id, userId, projectId, message, timestamp, type (user/system)
  - [x] Add relationships to User and Project entities

#### 2. Repository Layer
- [x] Create `ChatMessageRepository` interface
  - [x] Implement the repository interface

#### 3. Service Layer
- [x] Create `ChatbotService` interface
  - [x] Define method for processing user questions
  - [x] Define method for retrieving conversation history
  - [x] Define method for generating answers
  - [x] Define method for extracting document title from user query

- [ ] Create `ChatbotServiceImpl` class
  - [ ] Implement service methods
  - [ ] Add authorization checks for project access

#### 4. OpenAI Integration
- [x] Create `OpenAIService` interface
  - [x] Define method for generating answers from document content
  - [x] Define method for configuring API parameters

- [x] Create `OpenAIServiceImpl` class
  - [x] Implement service methods with proper error handling
  - [x] Add configuration for API key and model selection

#### 5. Controller Layer
- [x] Create `ChatbotController` class
  - [x] Implement controller methods
  - [x] Add proper authorization checks

#### 6. Integration Tests
- [ ] Write integration test for the complete flow

### Frontend Implementation

#### 1. API Client
- [x] Create `chatbotApi.ts` file
  - [x] Implement API client methods

#### 2. Redux State Management
- [x] Create `chatSlice.ts` file
  - [x] Define state interface with messages array, loading state, error state
  - [x] Implement slice with reducers and selectors

#### 3. Components
- [x] Update `ChatbotInterface` component
  - [x] Add message sending functionality
  - [x] Add conversation history display
  - [x] Add suggested queries like "what is document [title] about?"
  - [x] Implement functionality

## US3.4: Get Answers with Source References

### Backend Implementation

#### 1. Service Layer
- [ ] Update `OpenAIService` interface
  - [ ] Enhance method to return source references with answers

- [ ] Update `OpenAIServiceImpl` class
  - [ ] Implement enhanced service methods with prompt engineering for source attribution

#### 2. DTO Objects
- [ ] Create `ChatResponseDTO` class
  - [ ] Include fields: message, sources (list of document references)

#### 3. Controller Layer
- [ ] Update `ChatbotController` class
  - [ ] Update response format to include sources
  - [ ] Implement controller changes

#### 4. Integration Tests
- [ ] Write integration test for the complete flow

### Frontend Implementation

#### 1. API Client
- [x] Update `chatbotApi.ts` file
  - [x] Update response type to include sources

#### 2. Redux State Management
- [x] Update `chatSlice.ts` file
  - [x] Update state interface to include sources
  - [x] Update reducers to handle sources

#### 3. Components
- [x] Create `SourceReference` component
  - [x] Implement component

- [x] Update `ChatbotInterface` component
  - [x] Add source references to bot responses
  - [x] Implement functionality

## US3.5: Ask Questions Across All Projects

### Backend Implementation

#### 1. Service Layer
- [ ] Update `ChatbotService` interface
  - [ ] Add method for cross-project questions
  - [ ] Add method for retrieving accessible projects for a user

- [ ] Update `ChatbotServiceImpl` class
  - [ ] Implement service methods

#### 2. Controller Layer
- [ ] Update `ChatbotController` class
  - [ ] Implement controller methods
  - [ ] Add proper authorization checks for Director role

#### 3. Integration Tests
- [ ] Write integration test for the complete flow

### Frontend Implementation

#### 1. API Client
- [x] Update `chatbotApi.ts` file
  - [x] Add methods for global chat

#### 2. Redux State Management
- [x] Update `chatSlice.ts` file
  - [x] Add actions for global chat

#### 3. Components
- [x] Update `ChatbotInterface` component
  - [x] Add project scope selector (current project vs. all projects)
  - [x] Implement functionality

- [x] Update `SourceReference` component
  - [x] Add project information to source references
  - [x] Implement functionality

## Testing Strategy

### Unit Tests
- [ ] Backend: Repository tests
  - Test data operations with various parameters

- [ ] Backend: Service tests
  - Test document processing logic
  - Test OpenAI API integration
  - Test document title extraction from queries
  - Test authorization checks
  - Test error handling

- [ ] Backend: Controller tests
  - Test endpoints with mocked services
  - Test authorization requirements
  - Test response formats

- [ ] Frontend: Component tests
  - Test rendering with various props
  - Test user interactions
  - Test loading/error states

- [ ] Frontend: Redux tests
  - Test action creators
  - Test reducers
  - Test selectors
  - Test async thunks

### Integration Tests
- [ ] Backend API tests
  - Test complete flow from controller to OpenAI service
  - Test with authentication
  - Test authorization rules

- [ ] Frontend integration tests
  - Test component interaction
  - Test data flow through Redux
  - Test chatbot conversation flow

## Implementation Steps

1. [x] Implement document processors
2. [ ] Implement search indexing
3. [x] Implement chatbot service with document title extraction
4. [x] Implement OpenAI service
5. [x] Implement controllers
6. [x] Implement frontend components
7. [x] Integrate components into pages
8. [ ] Perform end-to-end testing

## Definition of Done

### US3.1: Document Content Indexing
- [ ] System automatically processes uploaded documents
- [ ] Text is successfully extracted from PDF, DOCX, and TXT files
- [ ] Extracted content is stored in a searchable index
- [ ] Failed indexing attempts are logged appropriately
- [ ] Indexing process runs in the background without blocking user operations

### US3.2: Access the Chatbot
- [x] Chatbot button is visible in the application
- [x] Clicking the button opens the chatbot interface
- [x] Interface includes input field and conversation display
- [x] Chatbot is accessible from both project pages and global dashboard

### US3.3: Ask Questions within a Single Project
- [ ] Users can type and submit questions about project documents
- [ ] Users can ask about specific documents with queries like "what is document [title] about?"
- [ ] System processes questions and provides relevant answers using OpenAI
- [ ] System correctly identifies document titles in user queries
- [ ] Answers are derived from the indexed content of the current project only
- [ ] Conversation history is maintained
- [ ] Responses are delivered within a reasonable time frame

### US3.4: Get Answers with Source References
- [ ] Chatbot answers include references to source documents
- [ ] Source references show document names
- [ ] Source references are clickable links
- [ ] Clicking a source opens the corresponding document
- [ ] Top 1-3 most relevant sources are displayed

### US3.5: Ask Questions Across All Projects
- [x] Directors can switch to global search mode
- [ ] Questions in global mode search across all accessible projects
- [ ] Answers synthesize information from multiple projects
- [ ] Source references include project information
- [x] Only Directors can access this functionality

### OpenAI Integration
- [ ] OpenAI API is properly configured with API keys
- [ ] Appropriate model is selected for generating responses
- [ ] Error handling for API failures is implemented
- [ ] Rate limiting is properly managed
- [ ] Prompts are engineered to provide accurate and relevant answers
- [ ] System can extract document titles from natural language queries 