# Detailed Implementation Checklist: US1.3 Create and Manage User Accounts

This document provides a comprehensive implementation guide for the "Create and Manage User Accounts" user story, breaking down both backend and frontend tasks into granular, actionable steps.

## Backend Implementation

### 1. User Domain Model

#### 1.1 Create User Entity ✅
- ✅ Create `User.java` class in `domain/model` package
- ✅ Implement fields matching database schema:
  - ✅ `id` (Long): Primary key
  - ✅ `email` (String): Unique, not null
  - ✅ `passwordHash` (String): Not null
  - ✅ `name` (String): Not null
  - ✅ `createdAt` (LocalDateTime): Not null
  - ✅ `updatedAt` (LocalDateTime): Not null
- ✅ Add JPA annotations (@Entity, @Table, @Id, etc.)
- ✅ Implement equals(), hashCode(), and toString() methods
- ✅ Add validation annotations (@NotNull, @Email, etc.)

#### 1.2 Create Role Entity ✅
- ✅ Create `Role.java` class in `domain/model` package
- ✅ Implement fields:
  - ✅ `id` (Long): Primary key
  - ✅ `name` (String): Unique, not null
- ✅ Add JPA annotations
- ✅ Implement equals(), hashCode(), and toString() methods
- ✅ Create predefined role constants (DIRECTOR, PROJECT_MANAGER, TEAM_MEMBER)

#### 1.3 Create User-Role Relationship ✅
- ✅ Add `roles` collection field to User entity
- ✅ Implement @ManyToMany relationship with Role entity
- ✅ Configure join table mapping for `user_roles` table
- ✅ Add helper methods for role management (addRole, removeRole, hasRole)

#### 1.4 Create DTOs ✅
- ✅ Create `UserCreateDTO.java` in `application/dto` package:
  - ✅ `email` (String)
  - ✅ `password` (String)
  - ✅ `name` (String)
  - ✅ `roleIds` (Set<Long>)
- ✅ Create `UserUpdateDTO.java`:
  - ✅ `email` (String)
  - ✅ `name` (String)
  - ✅ `roleIds` (Set<Long>)
  - ✅ `password` (String, optional)
- ✅ Create `UserResponseDTO.java`:
  - ✅ `id` (Long)
  - ✅ `email` (String)
  - ✅ `name` (String)
  - ✅ `roles` (Set<RoleDTO>)
  - ✅ `createdAt` (LocalDateTime)
  - ✅ `updatedAt` (LocalDateTime)
- ✅ Create `RoleDTO.java`:
  - ✅ `id` (Long)
  - ✅ `name` (String)

#### 1.5 Implement Entity-DTO Mappers ✅
- ✅ Create `UserMapper.java` in `application/mapper` package
- ✅ Implement methods:
  - ✅ `toEntity(UserCreateDTO)`: Maps DTO to new entity
  - ✅ `updateEntity(User, UserUpdateDTO)`: Updates entity from DTO
  - ✅ `toDto(User)`: Maps entity to response DTO
  - ✅ `toDtoList(List<User>)`: Maps entity list to DTO list
- ✅ Create `RoleMapper.java` with similar methods

### 2. User Repository ✅

#### 2.1 Create UserRepository Interface ✅
- ✅ Create `UserRepository.java` in `domain/repository` package
- ✅ Extend Spring Data JPA's `JpaRepository<User, Long>`
- ✅ Add query methods:
  - ✅ `Optional<User> findByEmail(String email)`
  - ✅ `Page<User> findAll(Pageable pageable)`
  - ✅ `List<User> findByRolesContaining(Role role)`
  - ✅ `boolean existsByEmail(String email)`

#### 2.2 Create Custom Query Methods ✅
- ✅ Add `@Query` annotations for complex queries
- ✅ Implement method for searching users by name or email:
  - ✅ `Page<User> findByNameContainingOrEmailContaining(String name, String email, Pageable pageable)`
- ✅ Add method for finding users not in a specific project:
  - ✅ `List<User> findByIdNotIn(List<Long> userIds)`
- ✅ Add advanced search query with single search term:
  - ✅ `Page<User> searchByNameOrEmail(String searchTerm, Pageable pageable)`

### 3. Role Repository ✅

#### 3.1 Create RoleRepository Interface ✅
- ✅ Create `RoleRepository.java` in `domain/repository` package
- ✅ Extend Spring Data JPA's `JpaRepository<Role, Long>`
- ✅ Add query methods:
  - ✅ `Optional<Role> findByName(String name)`
  - ✅ `List<Role> findByNameIn(Collection<String> names)`
  - ✅ `boolean existsByName(String name)`

#### 3.2 Create Role Data Initialization ✅
- ✅ Create `RoleDataInitializer.java` in `infrastructure/config` package
- ✅ Implement `CommandLineRunner` interface
- ✅ Add logic to create default roles if they don't exist
- ✅ Configure with @Bean annotation in configuration class

### 4. User Service ✅

#### 4.1 Create UserService Interface ✅
- ✅ Create `UserService.java` in `domain/service` package
- ✅ Define method signatures:
  - ✅ `UserResponseDTO createUser(UserCreateDTO userDto)`
  - ✅ `UserResponseDTO updateUser(Long id, UserUpdateDTO userDto)`
  - ✅ `void deleteUser(Long id)`
  - ✅ `UserResponseDTO getUserById(Long id)`
  - ✅ `Page<UserResponseDTO> getAllUsers(Pageable pageable)`
  - ✅ `Page<UserResponseDTO> searchUsers(String query, Pageable pageable)`
  - ✅ `boolean existsByEmail(String email)`

#### 4.2 Implement UserServiceImpl ✅
- ✅ Create `UserServiceImpl.java` in `application/service` package
- ✅ Implement `UserService` interface
- ✅ Inject dependencies:
  - ✅ `UserRepository`
  - ✅ `RoleRepository`
  - ✅ `PasswordEncoder`
  - ✅ `UserMapper`
- ✅ Implement user creation with password hashing
- ✅ Add validation for email uniqueness
- ✅ Implement role assignment logic
- ✅ Add update logic with optional password change
- ✅ Implement deletion with checks for existing relationships

#### 4.3 Create RoleService Interface and Implementation ✅
- ✅ Create `RoleService.java` in `domain/service` package
- ✅ Define method signatures:
  - ✅ `List<RoleDTO> getAllRoles()`
  - ✅ `RoleDTO getRoleById(Long id)`
- ✅ Create `RoleServiceImpl.java` in `application/service` package
- ✅ Implement methods using `RoleRepository` and `RoleMapper`

#### 4.4 Implement Validation Logic ✅
- ✅ Create custom validators for user creation/update
- ✅ Implement email format validation
- ✅ Add password strength validation
- ✅ Create role existence validation
- ✅ Implement validation for preventing self-deletion

### 5. User Controller ✅

#### 5.1 Create UserController ✅
- ✅ Create `UserController.java` in `interfaces/api` package
- ✅ Add `@RestController` and `@RequestMapping("/api/users")` annotations
- ✅ Inject `UserService`
- ✅ Implement endpoints:
  - ✅ `POST /api/users`: Create user
  - ✅ `GET /api/users`: List users with pagination
  - ✅ `GET /api/users/{id}`: Get user by ID
  - ✅ `PUT /api/users/{id}`: Update user
  - ✅ `DELETE /api/users/{id}`: Delete user
  - ✅ `GET /api/users/search`: Search users by query

#### 5.2 Create RoleController ✅
- ✅ Create `RoleController.java` in `interfaces/api` package
- ✅ Add `@RestController` and `@RequestMapping("/api/roles")` annotations
- ✅ Inject `RoleService`
- ✅ Implement endpoints:
  - ✅ `GET /api/roles`: List all roles
  - ✅ `GET /api/roles/{id}`: Get role by ID

#### 5.3 Implement Request Validation ✅
- ✅ Add `@Valid` annotation to controller methods
- ✅ Create custom validation error handler
- ✅ Implement detailed error responses
- ✅ Add validation for request parameters

#### 5.4 Configure Response Status Codes ✅
- ✅ Use appropriate HTTP status codes:
  - ✅ 201 Created for successful creation
  - ✅ 200 OK for successful retrieval/update
  - ✅ 204 No Content for successful deletion
  - ✅ 400 Bad Request for validation errors
  - ✅ 404 Not Found for non-existent resources
  - ✅ 409 Conflict for duplicate email

### 6. Security Implementation ✅

#### 6.1 Configure Authorization Rules ✅
- ✅ Update `SecurityConfig.java` in `infrastructure/config` package
- ✅ Add authorization rules:
  - ✅ Restrict user management to DIRECTOR role
  - ✅ Allow users to view their own profile
  - ✅ Configure method security with `@PreAuthorize`
- ✅ Implement custom permission evaluators

#### 6.2 Create Security Utilities ✅
- ✅ Implement `SecurityUtils.java` for common security operations
- ✅ Add methods:
  - ✅ `getCurrentUserId()`: Get ID of authenticated user
  - ✅ `hasRole(String role)`: Check if current user has role
  - ✅ `isCurrentUser(Long userId)`: Check if ID matches current user

#### 6.3 Implement Audit Logging ✅
- ✅ Create `AuditLogger.java` in `infrastructure/logging` package
- ✅ Add methods for logging user-related operations:
  - ✅ `logUserCreated(User user, String createdBy)`
  - ✅ `logUserUpdated(User user, String updatedBy)`
  - ✅ `logUserDeleted(Long userId, String deletedBy)`
  - ✅ `logRoleAssigned(Long userId, String roleName, String assignedBy)`

## Frontend Implementation

### 1. User Management State

#### 1.1 Create User Interfaces ✅
- ✅ Create `src/types/user.ts` with interfaces:
  - ✅ `User`: Matches UserResponseDTO fields
  - ✅ `Role`: Matches RoleDTO fields
  - ✅ `UserCreate`: Matches UserCreateDTO fields
  - ✅ `UserUpdate`: Matches UserUpdateDTO fields
  - ✅ `PaginatedResponse`: For handling paginated data
  - ✅ `UserSearchParams`: For search parameters
  - ✅ `UserFilterOptions`: For filtering options

#### 1.2 Create User State Slice ✅
- ✅ Create `src/redux/slices/userSlice.ts`
- ✅ Define state interface:
  - ✅ `users`: Array of User objects
  - ✅ `selectedUser`: User object or null
  - ✅ `loading`: Boolean
  - ✅ `error`: String or null
  - ✅ `pagination`: Object with total, page, size
- ✅ Implement reducers:
  - ✅ `setUsers`: Update users array
  - ✅ `setSelectedUser`: Set current user
  - ✅ `addUser`: Add new user to array
  - ✅ `updateUser`: Update existing user
  - ✅ `removeUser`: Remove user from array
  - ✅ `setLoading`: Update loading state
  - ✅ `setError`: Set error message

#### 1.3 Create User Thunks ✅
- ✅ Implement async thunks in `userSlice.ts`:
  - ✅ `fetchUsers`: Get paginated users
  - ✅ `fetchUserById`: Get single user
  - ✅ `createUser`: Create new user
  - ✅ `updateUser`: Update existing user
  - ✅ `deleteUser`: Delete user
  - ✅ `searchUsers`: Search users by query

#### 1.4 Create Role State Slice ✅
- ✅ Create `src/redux/slices/roleSlice.ts`
- ✅ Define state interface:
  - ✅ `roles`: Array of Role objects
  - ✅ `loading`: Boolean
  - ✅ `error`: String or null
- ✅ Implement reducers and thunks for role management

### 2. User API Service ✅

#### 2.1 Create User API Module ✅
- ✅ Create `src/api/userApi.ts`
- ✅ Implement methods using axios:
  - ✅ `getUsers(page, size)`: Fetch paginated users
  - ✅ `getUserById(id)`: Fetch single user
  - ✅ `createUser(userData)`: Create new user
  - ✅ `updateUser(id, userData)`: Update existing user
  - ✅ `deleteUser(id)`: Delete user
  - ✅ `searchUsers(query, page, size)`: Search users

#### 2.2 Create Role API Module ✅
- ✅ Create `src/api/roleApi.ts`
- ✅ Implement methods:
  - ✅ `getAllRoles()`: Fetch all roles
  - ✅ `getRoleById(id)`: Fetch single role

#### 2.3 Implement Error Handling ✅
- ✅ Create error interceptor for Axios
- ✅ Add response transformation for consistent error format
- ✅ Implement retry logic for transient failures
- ✅ Add request timeout handling

### 3. User Management Page ✅

#### 3.1 Create User Management Page Component ✅
- ✅ Create `src/pages/UserManagementPage.tsx`
- ✅ Implement page structure:
  - ✅ Header with title and create button
  - ✅ Search input
  - ✅ Role filter dropdown
  - ✅ User list component
  - ✅ Pagination controls

#### 3.2 Implement User List Component ✅
- ✅ Create `src/components/users/UserList.tsx`
- ✅ Design table or card layout for users
- ✅ Add columns:
  - ✅ Name
  - ✅ Email
  - ✅ Roles (as badges)
  - ✅ Created date
  - ✅ Actions (edit, delete)
- ✅ Implement sorting functionality
- ✅ Add loading state with skeleton loaders

#### 3.3 Create User Search Component ✅
- ✅ Create `src/components/users/UserSearch.tsx`
- ✅ Implement debounced search input
- ✅ Add clear button
- ✅ Create search history dropdown (optional)

#### 3.4 Implement Role Filter Component ✅
- ✅ Create `src/components/users/RoleFilter.tsx`
- ✅ Design multi-select dropdown for roles
- ✅ Implement filter application logic
- ✅ Add clear filters button

### 4. User Form Components ✅

#### 4.1 Create User Form Component ✅
- ✅ Create `src/components/users/CreateUserModal.tsx` and `EditUserModal.tsx`
- ✅ Implement form fields:
  - ✅ Email input with validation
  - ✅ Name input
  - ✅ Password input (with confirmation)
  - ✅ Role selection checkboxes
- ✅ Add form validation using React state
- ✅ Implement form submission handling
- ✅ Create loading state during submission

#### 4.2 Create User Creation Modal ✅
- ✅ Create `src/components/users/CreateUserModal.tsx`
- ✅ Design modal with form fields
- ✅ Add header with title
- ✅ Implement cancel and submit buttons
- ✅ Add success/error notifications

#### 4.3 Implement User Edit Modal ✅
- ✅ Create `src/components/users/EditUserModal.tsx`
- ✅ Extend form for editing
- ✅ Populate form with existing user data
- ✅ Make password field optional for updates
- ✅ Add confirmation for role changes

#### 4.4 Create Password Strength Component ✅
- ✅ Create `src/components/common/PasswordStrength.tsx`
- ✅ Implement password strength calculation
- ✅ Design strength indicator with color coding
- ✅ Add password requirements list
- ✅ Create password visibility toggle

### 5. User Actions UI ✅

#### 5.1 Implement User Action Buttons ✅
- ✅ Create action buttons in UserList component
- ✅ Design edit and delete buttons
- ✅ Add tooltips with action descriptions
- ✅ Implement permission-based rendering
- ✅ Add icon indicators for each action

#### 5.2 Create Delete Confirmation Dialog ✅
- ✅ Create `src/components/users/DeleteUserDialog.tsx`
- ✅ Design confirmation dialog with warning
- ✅ Add user information display
- ✅ Implement cancel and confirm buttons
- ✅ Create loading state during deletion

#### 5.3 Implement Role Badge Component ✅
- ✅ Implement role badges in UserList component
- ✅ Design badges with role-specific colors
- ✅ Add tooltips with role descriptions
- ✅ Implement compact display for multiple roles

#### 5.4 Create Notification System ✅
- ✅ Implement toast notifications for:
  - ✅ Successful user creation
  - ✅ Successful user update
  - ✅ Successful user deletion
  - ✅ Error notifications with retry options
- ✅ Add animation for smooth appearance/disappearance

## Testing Plan

### Backend Tests

#### Unit Tests
- Test `UserService` methods with Mockito
- Verify `RoleService` functionality
- Test validation logic and constraints
- Verify security rules and permissions

#### Integration Tests
- Test user CRUD operations through repository
- Verify role assignment functionality
- Test pagination and search features
- Verify email uniqueness constraint

#### API Tests
- Test all endpoints with MockMvc
- Verify proper status codes and responses
- Test validation error handling
- Verify authorization rules

### Frontend Tests

#### Component Tests
- Test `UserForm` validation
- Verify `UserList` rendering
- Test modal components
- Verify filter and search functionality

#### Redux Tests
- Test reducers with various actions
- Verify thunk behavior with mock API
- Test error handling in state
- Verify selector functionality

#### Integration Tests
- Test complete user management flow
- Verify form submission and API interaction
- Test error scenarios and recovery
- Verify permission-based UI rendering 